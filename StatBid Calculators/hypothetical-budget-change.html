<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hypothetical budget change</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autonumeric/2.0.10/autoNumeric.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #f5faff, #0195ff);
            animation: none;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        .cos_calculator_container {
            display: flex;
            justify-content: space-around;
            max-width: 80%;
            margin: 30px auto;
            background-color: #f5f5f5;
            border-radius: 33px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-height: 750px;
        }

        .cos_calculator_title {
            text-align: left;
            margin-left: 11%;
            font-size: 48px;
            font-weight: bold;
            color: #333;
        }

        .cos_calculator_name_section {
            margin-bottom: 90px;
            margin-left: 7%;
            font-size: 35px;
            font-weight: bold;
        }

        .cos_calculator_inputs {
            width: 50% !important;
            min-height: 643px;
        }

        .cos_calculator_input_section {
            margin-bottom: 20px;
        }

        .cos_calculator_row {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 26px;
        }

        .cos_calculator_label {
            font-size: 27px;
            color: #555;
            margin-bottom: 10px;
            text-align: center;
        }

        .cos_calculator_input {
            text-align: center;
            margin-bottom: 50px;
            width: 60%;
            padding: 8px;
            font-size: 27px;
            border: 1px solid #ccc;
            border-radius: 12px;
            background-color: #fff;
        }

        .cos_calculator_results {
            width: 50%;
            border-radius: 33px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #0195ff;
            color: #fff;
        }

        .gc_results {
            font-size: 30px;
            font-weight: bold;
        }

        .cos_calculator_results_row {
            display: flex;
            font-size: 26px;
            align-items: center;
            margin-bottom: 10px;
            flex-direction: column;
            justify-content: center;
        }


        .resa {
            height: 40%;
            background-color: #005a9b;
            display: flex;
            padding-top: 20px;
            width: 100%;

            padding-bottom: 15px;
            margin-inline: 50px !important;
            justify-content: space-evenly;
            border-top-left-radius: 33px;
            border-top-right-radius: 35px;
            align-items: center;
        }

        .resb {
            height: 35%;
            padding-top: 20px;
            width: 100%;
            display: flex;
            justify-content: flex-start;
            flex-direction: column;
            align-items: center;
        }

        #pieChartMarginal,
        #pieChartPaid {
            height: 180px !important;
            width: 180px !important;
            margin-bottom: 25px;
        }

        #cosChartContainer {
            width: 100%;
            background-color: #ccc;
        }

        #cosChart {
            min-width: 100%;

            max-height: 230px;
        }

        .tog {
            width: 100%;
            display: flex;
            justify-content: space-evenly;
            flex-direction: row;
            margin-top: 20px;
        }

        .pd {
            text-align: center;
            font-size: 22px;
        }

        @media (max-width: 1100px) {
            .cos_calculator_inputs {
                width: 30% !important;
            }

            .cos_calculator_results {
                width: 70% !important;
            }
        }

        @media (max-width: 768px) {
            .cos_calculator_inputs {
                width: 100% !important;
            }

            .cos_calculator_results {
                width: 100% !important;
            }

            .resa {
                display: flex;
                flex-direction: column;
            }

            .cos_calculator_title {
                font-size: 35px;
            }

            .cos_calculator_name_section {
                font-size: 22px;
            }

            .cos_calculator_label {
                font-size: 21px !important;
            }

            .cos_calculator_input {
                width: 74% !important;
                font-size: 23px !important;
            }

            .tog {
                flex-direction: column;
                align-items: center;
            }

            .pd {
                font-size: 21px;
            }

            body {
                background: linear-gradient(135deg, #f5faff, #0195ff);
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
            }

            .cos_calculator_container {
                display: flex;
                flex-direction: column;
                align-items: center;
                max-width: 80%;
                margin: 30px auto;
                background-color: #f5f5f5;
                border-radius: 33px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .cos_calculator_title {
                text-align: center;
                font-size: 37px;
                font-weight: bold;
                margin-top: 22px;
                color: #333;
                margin-inline: 20px;
            }
        }

        .cos_calculator_name_section {
            margin-bottom: 30px;
            margin-inline: 10px;
            font-size: 30px;
            font-weight: bold;
            text-align: center;
        }

        .cos_calculator_inputs {
            width: 100%;
        }

        .cos_calculator_input_section {
            margin-bottom: 20px;
        }

        .cos_calculator_row {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 10px;
            font-size: 26px;
        }

        .cos_calculator_label {
            font-size: 27px;
            color: #555;
            margin-bottom: 10px;
            text-align: center;
        }

        .cos_calculator_input {
            text-align: center;
            margin-bottom: 30px;
            width: 80%;
            padding: 8px;
            font-size: 27px;
            border: 1px solid #ccc;
            border-radius: 12px;
            background-color: #fff;
        }

        /* Results Section */
        .cos_calculator_results {
            width: 50%;
            /* Full width on mobile */
            border-radius: 33px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #0195ff;
            color: #fff;
        }

        .gc_results {
            font-size: 30px;
            font-weight: bold;
        }

        .cos_calculator_results_row {
            display: flex;
            flex-direction: column;
            /* Stack vertically */
            align-items: center;
            /* Center align */
            margin-bottom: 10px;
            font-size: 26px;
        }

        /* Chart */
        #pieChartMarginal,
        #pieChartPaid {

            margin-bottom: 15px;
        }

        #cosChartContainer {
            width: 100%;
            background-color: #ccc;

        }

        #cosChart {
            min-width: 100%;
            max-height: 230px;
        }
    </style>
</head>

<body>
    <h2 class="cos_calculator_title">Hypothetical COS Calculator</h2>

    <div class="cos_calculator_container">
        <div class="cos_calculator_inputs">
            <h3 class="cos_calculator_name_section">Business Metrics</h3>

            <div class="cos_calculator_input_section">
                <div class="cos_calculator_row">
                    <label class="cos_calculator_label" for="budget_spend_value">Current Tier Spend</label>
                    <input type="text" id="budget_spend_value" class="cos_calculator_input" value="$5000"
                        onchange="calculateBudgetCOS()" oninput="formatdolInput(this)">
                </div>
                <div class="cos_calculator_row">
                    <label class="cos_calculator_label" for="budget_revenue_value">Current Tier Revenue</label>
                    <input type="text" id="budget_revenue_value" class="cos_calculator_input" value="$20000"
                        onchange="calculateBudgetCOS()" oninput="formatdolInput(this)">
                </div>
                <div class="cos_calculator_row">
                    <label class="cos_calculator_label" for="budget_current_cos_value">Current COS</label>
                    <input type="text" id="budget_current_cos_value" class="cos_calculator_input" disabled>
                </div>
                <div class="cos_calculator_row">
                    <label class="cos_calculator_label" for="budget_new_cos_value">Hypothetical New Spend</label>
                    <input type="text" id="budget_new_cos_value" class="cos_calculator_input" value="$7500"
                        onchange="calculateBudgetCOS()" oninput="formatdolInput(this)">
                </div>
            </div>
        </div>

        <div class="cos_calculator_results">
            <div class="resa">
                <div class="cos_calculator_results_row">
                    <canvas id="pieChartPaid"></canvas>
                    <span id="budget_icos" class="gc_results"></span>
                    <span class="pd">Incremental COS</span>
                </div>
                <div class="cos_calculator_results_row">
                    <canvas id="pieChartMarginal"></canvas>
                    <span id="budget_hns" class="gc_results"></span>
                    <span class="pd"> Hypothetical New COS</span>
                </div>

            </div>
            <div id="cosChartContainer">
                <canvas id="cosChart"></canvas>
            </div>
            <div class="resb">

                <div class="cos_calculator_results_row"></div>
                <span class="pd"> Hypothetical New Revenue</span> <span id="budget_hnr" class="gc_results"></span>

                <div class="tog">
                    <div class="cos_calculator_results_row">
                        <span class="pd"> Incremental Spend</span><span id="budget_is" class="gc_results"></span>
                    </div>
                    <div class="cos_calculator_results_row">
                        <span class="pd"> Incremental Revenue </span><span id="budget_ir" class="gc_results"></span>
                    </div>
                </div>
            </div>


        </div>
    </div>



    <script>


        function formatdolInput(element) {
            let value = element.value.replace(/[^0-9.-]+/g, "");
            element.value = "$ " + value;
        }
        function calculateBudgetCOS() {
            var spend = parseFloat(document.getElementById("budget_spend_value").value.replace(/[^0-9.-]+/g, ""));
            var revenue = parseFloat(document.getElementById("budget_revenue_value").value.replace(/[^0-9.-]+/g, ""));
            var newSpend = parseFloat(document.getElementById("budget_new_cos_value").value.replace(/[^0-9.-]+/g, ""));

            var data = {
                spend: spend,
                revenue: revenue,
                newSpend: newSpend
            };

            data.current_cos = data.spend / data.revenue;
            data.budget_hns = Math.sqrt(data.newSpend / data.spend) * data.current_cos;
            data.budget_hnr = data.newSpend / data.budget_hns;
            data.budget_is = data.newSpend - data.spend;
            data.budget_ir = data.budget_hnr - data.revenue;
            data.budget_icos = (data.budget_is / data.budget_ir) * 100;

            // Display results
            if (isFinite(data.budget_hns)) {
                document.getElementById("budget_current_cos_value").value = (100 * data.current_cos).toFixed(2) + "%";
                document.getElementById("budget_hns").innerHTML = (100 * data.budget_hns).toFixed(2) + "%";
                document.getElementById("budget_hnr").innerHTML = "$" + data.budget_hnr.toFixed(2);
                document.getElementById("budget_is").innerHTML = "$" + data.budget_is.toFixed(2);
                document.getElementById("budget_ir").innerHTML = "$" + data.budget_ir.toFixed(2);
                document.getElementById("budget_icos").innerHTML = data.budget_icos.toFixed(2) + "%";
            }

            updatePieCharts((100 * data.budget_hns).toFixed(2), data.budget_icos.toFixed(2));
            updateCOSChart(data.spend, data.revenue, data.newSpend, data.budget_hnr);
        }
        var marginalChart, paidChart;
        function updatePieCharts(hns, icos) {
            const marginalPercentage = hns;
            const paidPercentage = icos;

            const ctxMarginal = document.getElementById('pieChartMarginal').getContext('2d');
            if (marginalChart) {
                marginalChart.destroy();
            }

            if (marginalPercentage < 0) {
                marginalChart = new Chart(ctxMarginal, {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: [0, 100],
                            backgroundColor: ['#2196F3', '#d6d6d6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                        },
                        animation: {
                            onComplete: function (chart) {
                                var width = chart.chart.width,
                                    height = chart.chart.height,
                                    ctx = chart.chart.ctx;
                                ctx.restore();

                                var fontSize = (height / 180).toFixed(2);
                                ctx.font = "bold " + fontSize + "em sans-serif";
                                ctx.textBaseline = "middle";
                                ctx.fillStyle = "#0195ff";

                                var text = " < 0%",
                                    textX = Math.round((width - ctx.measureText(text).width) / 2),
                                    textY = height / 1.9;

                                ctx.fillText(text, textX, textY);
                                ctx.save();
                            }
                        }
                    }
                });
            }
            else if (marginalPercentage > 100) {
                marginalChart = new Chart(ctxMarginal, {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: [100, 0],
                            backgroundColor: ['#2196F3', '#d6d6d6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                        },
                        animation: {
                            onComplete: function (chart) {
                                var width = chart.chart.width,
                                    height = chart.chart.height,
                                    ctx = chart.chart.ctx;
                                ctx.restore();

                                var fontSize = (height / 180).toFixed(2);
                                ctx.font = "bold " + fontSize + "em sans-serif";
                                ctx.textBaseline = "middle";
                                ctx.fillStyle = "white";

                                var text = " > 100%",
                                    textX = Math.round((width - ctx.measureText(text).width) / 2),
                                    textY = height / 1.9;

                                ctx.fillText(text, textX, textY);
                                ctx.save();
                            }
                        }
                    }
                });
            }
            else {
                marginalChart = new Chart(ctxMarginal, {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: [marginalPercentage, 100 - marginalPercentage],
                            backgroundColor: ['#2196F3', '#d6d6d6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                        },
                    }
                });
            }

            const ctxPaid = document.getElementById('pieChartPaid').getContext('2d');
            if (paidChart) {
                paidChart.destroy(); // Properly destroy the previous instance
            }

            if (paidPercentage < 0) {
                paidChart = new Chart(ctxPaid, {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: [0, 100],
                            backgroundColor: ['#2196F3', '#d6d6d6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                        },
                        animation: {
                            onComplete: function (chart) {
                                var width = chart.chart.width,
                                    height = chart.chart.height,
                                    ctx = chart.chart.ctx;
                                ctx.restore();

                                var fontSize = (height / 150).toFixed(2);
                                ctx.font = "bold " + fontSize + "em sans-serif";
                                ctx.textBaseline = "middle";
                                ctx.fillStyle = "#0195ff";

                                var text = " < 0%",
                                    textX = Math.round((width - ctx.measureText(text).width) / 2),
                                    textY = height / 1.9;

                                ctx.fillText(text, textX, textY);
                                ctx.save();
                            }
                        }
                    }
                });
            }
            else if (paidPercentage > 100) {
                paidChart = new Chart(ctxPaid, {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: [100, 0],
                            backgroundColor: ['#2196F3', '#d6d6d6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                        },
                        animation: {
                            onComplete: function (chart) {
                                var width = chart.chart.width,
                                    height = chart.chart.height,
                                    ctx = chart.chart.ctx;
                                ctx.restore();

                                var fontSize = (height / 150).toFixed(2);
                                ctx.font = "bold " + fontSize + "em sans-serif";
                                ctx.textBaseline = "middle";
                                ctx.fillStyle = "white";

                                var text = " > 100%",
                                    textX = Math.round((width - ctx.measureText(text).width) / 2),
                                    textY = height / 1.9;

                                ctx.fillText(text, textX, textY);
                                ctx.save();
                            }
                        }
                    }
                });
            }
            else {
                paidChart = new Chart(ctxPaid, {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: [paidPercentage, 100 - paidPercentage],
                            backgroundColor: ['#2196F3', '#d6d6d6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                        },
                    }
                });
            }
        }



        function updateCOSChart(spend, revenue, newSpend, newRevenue) {
            var ctx = document.getElementById('cosChart').getContext('2d');

            if (window.cosChart && typeof window.cosChart.destroy === 'function') {
                window.cosChart.destroy();
            }

            var data = {
                labels: ['Spend', 'Revenue'], // Labels for spend and revenue
                datasets: [
                    {
                        label: 'Current Spend vs Revenue',
                        data: [spend, revenue],
                        borderColor: '#ff0000', // Red line for current spend and revenue
                        backgroundColor: 'rgba(255, 0, 0, 0.2)', // Light red transparent background
                        pointBackgroundColor: '#ff0000',
                        pointRadius: 8,
                        borderWidth: 2,
                        fill: false, // No area fill under the line
                        tension: 0.3, // Smoothing the line curve
                        type: 'line' // Line chart to connect the points
                    },
                    {
                        label: 'New Spend vs Revenue',
                        data: [newSpend, newRevenue],
                        borderColor: '#00c853', // Green line for new spend and revenue
                        backgroundColor: 'rgba(0, 200, 83, 0.2)', // Light green transparent background
                        pointBackgroundColor: '#00c853',
                        pointRadius: 8,
                        borderWidth: 2,
                        fill: false, // No area fill under the line
                        tension: 0.3, // Smoothing the line curve
                        type: 'line' // Line chart to connect the points
                    }
                ]
            };

            var options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return `$${tooltipItem.raw.toLocaleString()}`;
                            }
                        },
                        backgroundColor: 'rgba(0, 0, 0, 0.7)',
                        titleFont: { size: 14 },
                        bodyFont: { size: 12 }
                    },
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 14
                            },
                            boxWidth: 20
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Spend ($)',
                            font: { size: 16 }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)' // Soften the grid lines
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Revenue ($)',
                            font: { size: 16 }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)' // Soften the grid lines
                        },
                        ticks: {
                            callback: function (value) {
                                return `$${value.toLocaleString()}`;
                            }
                        }
                    }
                }
            };

            window.cosChart = new Chart(ctx, {
                type: 'line',
                data: data,
                options: options
            });
        }



        $(document).ready(function () {
            calculateBudgetCOS();
            $('#budget_spend_value, #budget_revenue_value, #budget_new_cos_value').on('input', function () {
                calculateBudgetCOS();
            });
        });
    </script>
</body>

</html>